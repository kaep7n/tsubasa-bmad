# Story 2.2: Player List View

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to see a list of all my players,
**so that** I can quickly access player information

## Acceptance Criteria
1. ✅ `PlayerListComponent` created with grid layout (2 columns on mobile, 3+ on tablet)
2. ✅ Each player card displays:
   - Photo (circular avatar) or initials if no photo
   - First name + Last name
   - Jersey number (top-right badge)
   - Quick stats preview: Goals this season, Attendance rate
3. ✅ Data fetched from Supabase on component init:
   - Query: `SELECT * FROM players WHERE team_id = {id} AND deleted_at IS NULL ORDER BY first_name ASC`
   - Cached to IndexedDB after fetch
4. ✅ Search bar at top:
   - Filters by first name or last name (case-insensitive)
   - Debounced input (300ms delay)
5. ✅ Filter dropdown:
   - "All Players" (default)
   - "Starters"
   - "Substitutes"
   - "No Squad Assigned"
6. ✅ Sort options (dropdown):
   - Alphabetical (A-Z)
   - Jersey Number (1-99)
   - Goals (Descending)
7. ✅ FAB: "Add Player" button (navigates to player creation form)
8. ✅ Empty state: "No players yet - tap + to add your first player"
9. ✅ Tap card: Navigate to player detail screen
10. ✅ Long-press card: Show quick actions (Edit, Delete)
11. ✅ Offline mode: Works from IndexedDB cache, shows sync status indicator
12. ✅ Pull-to-refresh: Re-fetches from Supabase
13. ✅ Loading state: Skeleton cards while data loads
14. ✅ Unit test: Verify filtering and sorting logic
15. ✅ E2E test: Navigate to player list, verify players displayed

## Tasks / Subtasks

- [ ] **Task 1: Generate PlayerListComponent** (AC: 1)
  - [ ] Run: `ng generate component features/players/pages/player-list`
  - [ ] Add to players feature routes: `/players`
  - [ ] Configure lazy loading in `players.routes.ts`

- [ ] **Task 2: Create PlayerService** (AC: 3)
  - [ ] Create `/src/app/features/players/services/player.service.ts`
  - [ ] Implement `getPlayers()` method querying Supabase
  - [ ] Implement caching to IndexedDB using Dex ie.js
  - [ ] Return Observable<Player[]> with RxJS
  - [ ] Add error handling for network failures

- [ ] **Task 3: Build Player Card Component** (AC: 2)
  - [ ] Create `/src/app/features/players/components/player-card.component.ts`
  - [ ] Display player photo or initials avatar
  - [ ] Show first_name, last_name, jersey_number
  - [ ] Integrate with PlayerStatsService for goals/attendance (Story 2.7 dependency)
  - [ ] Style with Angular Material Card + Tailwind

- [ ] **Task 4: Implement Grid Layout** (AC: 1)
  - [ ] Use CSS Grid: `grid-template-columns: repeat(auto-fill, minmax(150px, 1fr))`
  - [ ] Responsive breakpoints: 2 cols mobile, 3+ cols tablet/desktop
  - [ ] Add gap between cards for visual separation

- [ ] **Task 5: Add Search Functionality** (AC: 4)
  - [ ] Add search input with Material mat-form-field
  - [ ] Implement debounced search using RxJS debounceTime(300)
  - [ ] Filter players array by first_name OR last_name (case-insensitive)
  - [ ] Use Angular Signals for reactive filtering

- [ ] **Task 6: Add Filter Dropdown** (AC: 5)
  - [ ] Add mat-select for squad filtering
  - [ ] Options: All | Starters | Substitutes | Unassigned
  - [ ] Filter logic: `players().filter(p => p.squad === selectedSquad || ...)`

- [ ] **Task 7: Add Sort Dropdown** (AC: 6)
  - [ ] Add mat-select for sort options
  - [ ] Implement sorting: Alphabetical, Jersey Number, Goals
  - [ ] Use JavaScript array.sort() with appropriate comparators

- [ ] **Task 8: Add FAB Button** (AC: 7)
  - [ ] Use Angular Material FAB: `<button mat-fab>`
  - [ ] Position: Fixed bottom-right
  - [ ] Icon: mat-icon "add"
  - [ ] Navigate to `/players/new` on click

- [ ] **Task 9: Implement Empty State** (AC: 8)
  - [ ] Show empty state component when `players().length === 0`
  - [ ] Display message and illustration
  - [ ] CTA button: "Add First Player"

- [ ] **Task 10: Add Navigation and Gestures** (AC: 9, 10)
  - [ ] Tap card: Navigate to `/players/:id`
  - [ ] Long-press: Use Angular CDK long-press directive
  - [ ] Show action sheet with Edit/Delete options

- [ ] **Task 11: Implement Offline Mode** (AC: 11)
  - [ ] Check network status using NetworkStatusService
  - [ ] Load from IndexedDB if offline
  - [ ] Show sync indicator badge when data pending sync

- [ ] **Task 12: Add Pull-to-Refresh** (AC: 12)
  - [ ] Use Angular CDK Scrolling or custom swipe directive
  - [ ] On pull: Call `playerService.refreshPlayers()`
  - [ ] Show loading spinner during refresh

- [ ] **Task 13: Add Loading Skeletons** (AC: 13)
  - [ ] Create skeleton card component
  - [ ] Display 6 skeleton cards while `isLoading = true`
  - [ ] Use Angular Material skeleton loader or custom CSS

- [ ] **Task 14: Write Unit Tests** (AC: 14)
  - [ ] Test filtering by name
  - [ ] Test squad filter logic
  - [ ] Test sorting functions
  - [ ] Mock PlayerService with test data

- [ ] **Task 15: Write E2E Test** (AC: 15)
  - [ ] Playwright test: Navigate to /players
  - [ ] Verify player cards render
  - [ ] Test search functionality
  - [ ] Test navigation to detail screen

## Dev Notes

### Component Structure
Component location: `/src/app/features/players/pages/player-list/player-list.component.ts`

**Template structure:**
- Top toolbar: Search bar + filter/sort dropdowns
- Main content: Grid of player cards
- FAB button: Fixed position for "Add Player"
[Source: architecture/12-unified-project-structure.md]

### State Management
Use Angular Signals for reactive state:
```typescript
readonly players = signal<Player[]>([]);
readonly filteredPlayers = computed(() => this.applyFilters(this.players()));
readonly searchTerm = signal<string>('');
readonly squadFilter = signal<string>('all');
```
[Source: architecture/17-coding-standards.md: "State Updates: Use Signals .update() or .set()"]

### Offline-First Pattern
1. Check IndexedDB first for cached players
2. Fetch from Supabase in background
3. Update IndexedDB cache with fresh data
4. Use NetworkStatusService to detect online/offline
[Source: architecture/10-frontend-architecture.md]

### Data Fetching
```typescript
getPlayers(): Observable<Player[]> {
  return this.supabase
    .from('players')
    .select('*')
    .eq('team_id', this.teamId)
    .is('deleted_at', null)
    .order('first_name', { ascending: true });
}
```
RLS automatically filters by team_id, but explicit filter improves query performance.
[Source: architecture/11-backend-architecture.md]

## Dev Notes: Testing

### Unit Test Requirements
**Test file:** `player-list.component.spec.ts`

Test cases:
- Players load and display correctly
- Search filters players by name
- Squad filter shows correct subset
- Sorting changes player order
- Empty state shows when no players
[Source: architecture/16-testing-strategy.md]

### E2E Test Requirements
**Test file:** `tests/e2e/player-management.spec.ts`

Flow:
1. Login as coach
2. Navigate to /players
3. Verify player list loads
4. Test search input
5. Tap player card → verify navigation
[Source: architecture/16-testing-strategy.md]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation for Epic 2 | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
