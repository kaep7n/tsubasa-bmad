# Story 3.5: Mark Training Attendance

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to mark player attendance for each training session,
**so that** I can track participation rates

## Acceptance Criteria
1. ✅ `TrainingAttendanceComponent` displayed on session detail screen
2. ✅ Player list with three-state toggles: Attended | Excused | Absent
3. ✅ Quick actions: "Mark All Attended", "Reset"
4. ✅ On attendance change: Upsert training_attendance record
5. ✅ Offline handling: Changes work offline
6. ✅ Optimistic UI: Toggle updates immediately
7. ✅ Search filter: Filter players by name
8. ✅ Display attendance rate
9. ✅ Unit test: Verify upsert logic
10. ✅ E2E test: Mark attendance, verify saved

## Tasks / Subtasks

- [x] **Task 1: Generate TrainingAttendanceComponent** (AC: 1)
  - [x] Create component in training feature
  - [x] Add to training detail screen

- [x] **Task 2: Build Player List with Toggles** (AC: 2)
  - [x] Load all active players for team
  - [x] Three-state button component: Attended (green) | Excused (yellow) | Absent (red)
  - [x] Default: Absent (no record)

- [x] **Task 3: Implement Quick Actions** (AC: 3)
  - [x] "Mark All Attended" button
  - [x] "Reset" button clears all records

- [x] **Task 4: Implement Attendance Upsert** (AC: 4)
  - [x] On toggle: INSERT or UPDATE training_attendance
  - [x] Use Supabase upsert: `.upsert({ training_session_id, player_id, status })`
  - [x] Update IndexedDB

- [x] **Task 5: Offline Handling** (AC: 5, 6)
  - [x] Optimistic UI update
  - [x] Queue sync operation
  - [x] Revert on failure

- [x] **Task 6: Search Filter** (AC: 7)
  - [x] Add search input
  - [x] Filter players by first_name or last_name

- [x] **Task 7: Display Attendance Rate** (AC: 8)
  - [x] Calculate: attended / total * 100
  - [x] Display at top: "12/15 attended (80%)"

- [x] **Task 8: Write Tests** (AC: 9, 10)
  - [x] Unit test upsert logic
  - [x] E2E test mark attendance

## Dev Notes

Component location: `/src/app/features/training/components/training-attendance/`

Three-state toggle pattern allows nuanced attendance tracking.
[Source: PRD Epic 3 Story 3.5]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
