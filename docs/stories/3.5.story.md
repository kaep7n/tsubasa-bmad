# Story 3.5: Mark Training Attendance

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to mark player attendance for each training session,
**so that** I can track participation rates

## Acceptance Criteria
1. ✅ `TrainingAttendanceComponent` displayed on session detail screen
2. ✅ Player list with three-state toggles: Attended | Excused | Absent
3. ✅ Quick actions: "Mark All Attended", "Reset"
4. ✅ On attendance change: Upsert training_attendance record
5. ✅ Offline handling: Changes work offline
6. ✅ Optimistic UI: Toggle updates immediately
7. ✅ Search filter: Filter players by name
8. ✅ Display attendance rate
9. ✅ Unit test: Verify upsert logic
10. ✅ E2E test: Mark attendance, verify saved

## Tasks / Subtasks

- [ ] **Task 1: Generate TrainingAttendanceComponent** (AC: 1)
  - [ ] Create component in training feature
  - [ ] Add to training detail screen

- [ ] **Task 2: Build Player List with Toggles** (AC: 2)
  - [ ] Load all active players for team
  - [ ] Three-state button component: Attended (green) | Excused (yellow) | Absent (red)
  - [ ] Default: Absent (no record)

- [ ] **Task 3: Implement Quick Actions** (AC: 3)
  - [ ] "Mark All Attended" button
  - [ ] "Reset" button clears all records

- [ ] **Task 4: Implement Attendance Upsert** (AC: 4)
  - [ ] On toggle: INSERT or UPDATE training_attendance
  - [ ] Use Supabase upsert: `.upsert({ training_session_id, player_id, status })`
  - [ ] Update IndexedDB

- [ ] **Task 5: Offline Handling** (AC: 5, 6)
  - [ ] Optimistic UI update
  - [ ] Queue sync operation
  - [ ] Revert on failure

- [ ] **Task 6: Search Filter** (AC: 7)
  - [ ] Add search input
  - [ ] Filter players by first_name or last_name

- [ ] **Task 7: Display Attendance Rate** (AC: 8)
  - [ ] Calculate: attended / total * 100
  - [ ] Display at top: "12/15 attended (80%)"

- [ ] **Task 8: Write Tests** (AC: 9, 10)
  - [ ] Unit test upsert logic
  - [ ] E2E test mark attendance

## Dev Notes

Component location: `/src/app/features/training/components/training-attendance/`

Three-state toggle pattern allows nuanced attendance tracking.
[Source: PRD Epic 3 Story 3.5]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
