# Story 3.6: Training Attendance Statistics

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to view attendance statistics per training session and per player,
**so that** I can identify participation trends

## Acceptance Criteria
1. ✅ `TrainingStatsComponent` accessible from training list menu
2. ✅ Display options: Per-session view, Per-player view
3. ✅ Per-session view: List sessions with attendance summary
4. ✅ Per-player view: List players with attendance rate %
5. ✅ Date range filter: Season, Last Month, Last 3 Months, All Time
6. ✅ Export button: "Export to CSV"
7. ✅ Data aggregated from IndexedDB (offline-capable)
8. ✅ Empty state message
9. ✅ Unit test: Verify attendance rate calculation
10. ✅ E2E test: View statistics, verify rates

## Tasks / Subtasks

- [ ] **Task 1: Generate TrainingStatsComponent** (AC: 1)
  - [ ] Create component
  - [ ] Add route: `/training/stats`
  - [ ] Add menu item in training list

- [ ] **Task 2: Build View Toggle** (AC: 2)
  - [ ] Toggle buttons: Per-session | Per-player
  - [ ] Switch between views

- [ ] **Task 3: Implement Per-Session View** (AC: 3)
  - [ ] Query training_sessions with attendance aggregation
  - [ ] Display: Date, Attendance (12/15 - 80%)
  - [ ] Sort by date descending

- [ ] **Task 4: Implement Per-Player View** (AC: 4)
  - [ ] Query players with attendance rate calculation
  - [ ] Display: Player name, Sessions attended/Total, Rate %
  - [ ] Color-coded: Green (90%+), Yellow (70-89%), Red (<70%)

- [ ] **Task 5: Add Date Range Filter** (AC: 5)
  - [ ] Dropdown: Season, Last Month, Last 3 Months, All Time
  - [ ] Filter queries based on selection

- [ ] **Task 6: Implement CSV Export** (AC: 6)
  - [ ] Generate CSV from player attendance data
  - [ ] Trigger download

- [ ] **Task 7: Aggregate from IndexedDB** (AC: 7)
  - [ ] Use Dexie queries for offline capability
  - [ ] Calculate rates client-side

- [ ] **Task 8: Add Empty State** (AC: 8)
  - [ ] Show message when no data

- [ ] **Task 9: Write Tests** (AC: 9, 10)
  - [ ] Unit test rate calculations
  - [ ] E2E test view stats

## Dev Notes

Component location: `/src/app/features/training/pages/training-stats/`

Attendance rate calculation:
```typescript
const rate = (attended / totalSessions) * 100;
```
[Source: PRD Epic 3 Story 3.6]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
