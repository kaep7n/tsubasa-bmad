# Story 3.7: Cancel Training Session

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to cancel a training session,
**so that** cancelled sessions are reflected in the schedule

## Acceptance Criteria
1. ✅ "Cancel Session" button on training session detail screen
2. ✅ Confirmation dialog with preservation message
3. ✅ On confirm: Soft delete (set deleted_at), show undo toast
4. ✅ Undo functionality: Restore within 5 seconds
5. ✅ Cancelled sessions: Excluded from list by default, option to show
6. ✅ Offline handling: Cancellation works offline
7. ✅ Unit test: Verify soft delete and undo
8. ✅ E2E test: Cancel session, undo, verify restored

## Tasks / Subtasks

- [ ] **Task 1: Add Cancel Button** (AC: 1)
  - [ ] Add button to training detail screen
  - [ ] Style with warn color

- [ ] **Task 2: Create Confirmation Dialog** (AC: 2)
  - [ ] Material Dialog component
  - [ ] Message: "Attendance records will be preserved"
  - [ ] Actions: Keep Session | Cancel Session

- [ ] **Task 3: Implement Soft Delete** (AC: 3)
  - [ ] Update: SET deleted_at = now()
  - [ ] Update IndexedDB
  - [ ] Navigate back
  - [ ] Show snackbar with undo

- [ ] **Task 4: Implement Undo** (AC: 4)
  - [ ] 5-second snackbar with Undo action
  - [ ] On undo: SET deleted_at = null
  - [ ] Re-sync to Supabase

- [ ] **Task 5: Update List Query** (AC: 5)
  - [ ] Filter: WHERE deleted_at IS NULL
  - [ ] Add toggle to show cancelled sessions

- [ ] **Task 6: Offline Handling** (AC: 6)
  - [ ] Queue delete operation when offline

- [ ] **Task 7: Write Tests** (AC: 7, 8)
  - [ ] Unit test soft delete
  - [ ] E2E test cancel and undo

## Dev Notes

Soft delete pattern preserves attendance records for historical statistics.
[Source: PRD Epic 3 Story 3.7]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
