# Story 3.7: Cancel Training Session

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to cancel a training session,
**so that** cancelled sessions are reflected in the schedule

## Acceptance Criteria
1. ✅ "Cancel Session" button on training session detail screen
2. ✅ Confirmation dialog with preservation message
3. ✅ On confirm: Soft delete (set deleted_at), show undo toast
4. ✅ Undo functionality: Restore within 5 seconds
5. ✅ Cancelled sessions: Excluded from list by default, option to show
6. ✅ Offline handling: Cancellation works offline
7. ✅ Unit test: Verify soft delete and undo
8. ✅ E2E test: Cancel session, undo, verify restored

## Tasks / Subtasks

- [x] **Task 1: Add Cancel Button** (AC: 1)
  - [x] Add button to training detail screen
  - [x] Style with warn color

- [x] **Task 2: Create Confirmation Dialog** (AC: 2)
  - [x] Material Dialog component
  - [x] Message: "Attendance records will be preserved"
  - [x] Actions: Keep Session | Cancel Session

- [x] **Task 3: Implement Soft Delete** (AC: 3)
  - [x] Update: SET deleted_at = now()
  - [x] Update IndexedDB
  - [x] Navigate back
  - [x] Show snackbar with undo

- [x] **Task 4: Implement Undo** (AC: 4)
  - [x] 5-second snackbar with Undo action
  - [x] On undo: SET deleted_at = null
  - [x] Re-sync to Supabase

- [x] **Task 5: Update List Query** (AC: 5)
  - [x] Filter: WHERE deleted_at IS NULL
  - [x] Add toggle to show cancelled sessions

- [x] **Task 6: Offline Handling** (AC: 6)
  - [x] Queue delete operation when offline

- [x] **Task 7: Write Tests** (AC: 7, 8)
  - [x] Unit test soft delete
  - [x] E2E test cancel and undo

## Dev Notes

Soft delete pattern preserves attendance records for historical statistics.
[Source: PRD Epic 3 Story 3.7]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
