# Story 4.3: Create Game (Manual Entry)

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to create a game manually,
**so that** I can track games that aren't in my calendar

## Acceptance Criteria
1. ✅ `CreateGameComponent` with form fields: opponent, date, time, location, home/away
2. ✅ Form defaults: next Saturday, 10:00 AM
3. ✅ On submit: Insert to Supabase, save to IndexedDB, navigate to detail, show toast
4. ✅ Offline handling: Form submission works offline
5. ✅ Error handling: Network failures, validation errors
6. ✅ Loading state: Disable form during submission
7. ✅ Cancel button
8. ✅ Unit test: Verify validation and submission
9. ✅ E2E test: Create game, verify saved

## Tasks / Subtasks

- [ ] **Task 1: Generate CreateGameComponent** (AC: 1)
  - [ ] Run: `ng generate component features/games/pages/game-form`
  - [ ] Add route: `/games/new`

- [ ] **Task 2: Build Form** (AC: 1, 2)
  - [ ] Reactive form with FormBuilder
  - [ ] Field: Opponent Name (required, text input)
  - [ ] Field: Date (required, date picker, default: next Saturday)
  - [ ] Field: Time (required, time picker, default: 10:00 AM)
  - [ ] Field: Location (optional, text input)
  - [ ] Field: Home/Away (optional, radio buttons: Home | Away)
  - [ ] Validators: opponent required, date required, time required

- [ ] **Task 3: Implement Submission** (AC: 3)
  - [ ] Generate UUID: crypto.randomUUID()
  - [ ] Combine date + time into timestamptz
  - [ ] Insert to Supabase: games table with status='scheduled'
  - [ ] Save to IndexedDB
  - [ ] Navigate to /games/:id
  - [ ] Show toast: "Game created: {Opponent} on {Date}"

- [ ] **Task 4: Offline Handling** (AC: 4, 5, 6)
  - [ ] Check network status
  - [ ] If offline: Save to IndexedDB, add to sync queue
  - [ ] Error handling: Retry with exponential backoff
  - [ ] Validation errors: Inline error messages
  - [ ] Loading state: Disable submit button

- [ ] **Task 5: Cancel Button** (AC: 7)
  - [ ] Check form dirty state
  - [ ] Show confirmation if dirty
  - [ ] Navigate back to /games

- [ ] **Task 6: Write Tests** (AC: 8, 9)
  - [ ] Unit test: Form validation
  - [ ] Unit test: Date/time combination
  - [ ] Unit test: Offline submission
  - [ ] E2E test: Create game flow

## Dev Notes

Component location: `/src/app/features/games/pages/game-form/`

Will be reused for edit mode (Story 4.4) by detecting route params.

Default date calculation:
```typescript
const nextSaturday = () => {
  const today = new Date();
  const daysUntilSaturday = (6 - today.getDay() + 7) % 7 || 7;
  return new Date(today.setDate(today.getDate() + daysUntilSaturday));
};
```

Date/time combination:
```typescript
const combinedDate = new Date(`${dateValue}T${timeValue}`);
```

[Source: PRD Epic 4 Story 4.3, Architecture Section 7 Offline-First Architecture]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
