# Story 4.4: Edit Game Details

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to edit game details,
**so that** I can correct mistakes or update information

## Acceptance Criteria
1. ✅ "Edit Game" button on game detail screen
2. ✅ `EditGameComponent` created (reuses form from CreateGameComponent)
3. ✅ Form pre-populated with existing game data
4. ✅ On submit: Update Supabase, IndexedDB, calendar (if synced), navigate back, show toast
5. ✅ Restrictions: Cannot edit if in_progress or completed (show warning)
6. ✅ Protections: Can edit opponent name, location even if protected
7. ✅ Offline handling: Form submission works offline
8. ✅ Cancel button: Navigate back without saving
9. ✅ Unit test: Verify update logic and restrictions
10. ✅ E2E test: Edit game, verify changes saved

## Tasks / Subtasks

- [ ] **Task 1: Add Edit Button** (AC: 1)
  - [ ] Add edit button to game detail screen
  - [ ] Navigate to `/games/:id/edit`
  - [ ] Hide button if status = 'in_progress' or 'completed'

- [ ] **Task 2: Setup Edit Mode in GameFormComponent** (AC: 2, 3)
  - [ ] Detect edit mode from route params
  - [ ] Load existing game data
  - [ ] Pre-populate form with patchValue()

- [ ] **Task 3: Implement Update Submission** (AC: 4)
  - [ ] Call gamesService.updateGame()
  - [ ] Update Supabase and IndexedDB
  - [ ] Set updated_at = now()
  - [ ] If calendar_sync_id exists: Update Google Calendar event
  - [ ] Navigate to `/games/:id`
  - [ ] Show success toast

- [ ] **Task 4: Add Restrictions** (AC: 5, 6)
  - [ ] Check game status on load
  - [ ] If in_progress or completed: Show warning modal
  - [ ] Allow override for opponent name and location only
  - [ ] Disable date/time fields if protected

- [ ] **Task 5: Offline Handling** (AC: 7)
  - [ ] Check network status
  - [ ] Queue UPDATE operation if offline
  - [ ] Queue calendar sync separately

- [ ] **Task 6: Cancel Button** (AC: 8)
  - [ ] Check form dirty state
  - [ ] Show confirmation if dirty
  - [ ] Navigate back

- [ ] **Task 7: Write Tests** (AC: 9, 10)
  - [ ] Unit test update logic
  - [ ] Unit test restrictions
  - [ ] E2E test edit and verify

## Dev Notes

Component reuse: GameFormComponent handles both create (Story 4.3) and edit (Story 4.4).

Detection:
```typescript
const id = this.route.snapshot.paramMap.get('id');
this.isEditMode = !!id;
```

Restrictions:
```typescript
if (game.status === 'in_progress' || game.status === 'completed') {
  this.showWarningDialog();
  // Only allow opponent and location edits
  this.form.get('date')?.disable();
  this.form.get('time')?.disable();
}
```

Calendar sync update:
```typescript
if (game.calendar_sync_id) {
  await this.googleCalendarService.updateEvent(game.calendar_sync_id, gameData);
}
```

[Source: PRD Epic 4 Story 4.4, Architecture Section 9 Third-Party Integrations]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
