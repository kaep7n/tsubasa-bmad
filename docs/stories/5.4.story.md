# Story 5.4: Goal Logging Workflow (Scorer Selection)

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to log a goal with minimal taps (<5 seconds),
**so that** I can track scoring without missing game action

## Acceptance Criteria
1. ✅ "Log Goal" FAB always visible on live game screen
2. ✅ Tapping FAB opens modal with smart-sorted player list
3. ✅ Player list sorting: Prior scorers → Frequent players → Alphabetical
4. ✅ Visual indicator shows prior goals next to player name
5. ✅ Single tap on player logs goal immediately
6. ✅ Goal record: Creates with current minute, saves to IndexedDB, queues sync
7. ✅ Updates scoreboard (+1), shows toast confirmation
8. ✅ "Opponent Goal" button at bottom of modal
9. ✅ Large touch targets (56px min height)
10. ✅ Search filter for large squads (>15 players)
11. ✅ Modal dismisses on outside tap or back button
12. ✅ Offline: goal queued, visible immediately
13. ✅ E2E test: Log goal in <3 taps, verify scoreboard and timeline

## Tasks / Subtasks

- [ ] **Task 1: Add Log Goal FAB** (AC: 1)
  - [ ] Position: Bottom-right, z-index: 90
  - [ ] Icon: Soccer ball or plus sign
  - [ ] Always visible (fixed positioning)
  - [ ] Material FAB component

- [ ] **Task 2: Create Goal Logging Modal** (AC: 2)
  - [ ] Generate component: `GoalLogModalComponent`
  - [ ] Material Dialog wrapper
  - [ ] Full-screen on mobile, centered on tablet

- [ ] **Task 3: Build Smart-Sorted Player List** (AC: 3, 4)
  - [ ] Load all active players for team
  - [ ] Sort by: scorers this game → usage frequency → alphabetical
  - [ ] Display goal count badge next to player name
  - [ ] Use PlayerSortingService (Story 5.9)

- [ ] **Task 4: Implement Single-Tap Logging** (AC: 5, 6, 7)
  - [ ] Click handler on player list item
  - [ ] Generate UUID for goal_id
  - [ ] Create goal record with:
    - game_id, player_id
    - scored_at_minute = currentMinute()
    - scored_at_timestamp = new Date()
    - sync_state = 'pending'
  - [ ] Save to IndexedDB
  - [ ] Add to sync queue
  - [ ] Close modal
  - [ ] Increment team score signal
  - [ ] Show toast: "Goal by [Player Name] - [Minute]'"

- [ ] **Task 5: Add Opponent Goal Button** (AC: 8)
  - [ ] Button at bottom of modal
  - [ ] Distinct styling (warn color)
  - [ ] Navigate to opponent goal flow (Story 5.6)

- [ ] **Task 6: Add Search Filter** (AC: 10)
  - [ ] Text input at top of list
  - [ ] Filter players by first_name or last_name
  - [ ] Real-time filtering

- [ ] **Task 7: Implement Large Touch Targets** (AC: 9)
  - [ ] List item min-height: 56px
  - [ ] Horizontal padding: 16px
  - [ ] Vertical spacing: 8px

- [ ] **Task 8: Add Dismissal Behavior** (AC: 11)
  - [ ] Close on backdrop click
  - [ ] Close on back button (Android)
  - [ ] Close on escape key (desktop)

- [ ] **Task 9: Write Tests** (AC: 13)
  - [ ] E2E test: Open modal, select player, verify goal logged
  - [ ] E2E test: Verify scoreboard increments
  - [ ] E2E test: Verify timeline updates
  - [ ] E2E test: Complete flow in <3 taps

## Dev Notes

Component location: `/src/app/features/games/components/goal-log-modal/`

Performance requirement: <5 seconds from FAB tap to goal logged (target: 2-3 seconds).

Smart sorting prioritizes frequently selected players, reducing cognitive load during high-pressure situations.

UUID generation:
```typescript
const goalId = crypto.randomUUID();
```

Goal record creation:
```typescript
const goal: Goal = {
  id: goalId,
  game_id: this.gameId,
  player_id: playerId,
  scored_at_minute: this.timerService.currentMinute(),
  scored_at_timestamp: new Date().toISOString(),
  sync_state: 'pending'
};
```

Toast pattern:
```typescript
this.snackBar.open(`Goal by ${player.first_name} ${player.last_name} - ${minute}'`, 'Undo', {
  duration: 5000
});
```

[Source: PRD Epic 5 Story 5.4, Architecture Section 16 User Experience]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
