# Story 5.5: Assist Tracking (Multi-Select Enhancement)

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to optionally track assists when logging a goal,
**so that** I can credit players who contributed to scoring

## Acceptance Criteria
1. ✅ After selecting scorer, modal transitions to "Add Assists?" screen
2. ✅ Same smart-sorted player list (excluding scorer)
3. ✅ Multi-select interface: tap to toggle selection, checkmark appears
4. ✅ "Skip" button to save goal without assists
5. ✅ "Save" button to save goal with selected assists (1-3 players typical)
6. ✅ Timeout after 10 seconds auto-saves with no assists
7. ✅ Assists saved as `goal_assists` records linked to goal
8. ✅ Long-press on scorer skips assist screen (single-tap workflow)
9. ✅ Timeline shows assists: "Goal: [Scorer] (Assists: [Name1], [Name2])"
10. ✅ Sync service handles goal + assists atomically
11. ✅ E2E test: Log goal with 2 assists, verify DB and timeline

## Tasks / Subtasks

- [ ] **Task 1: Add Assist Selection Screen** (AC: 1, 2)
  - [ ] After scorer selected, transition to new screen
  - [ ] Header: "Add Assists?"
  - [ ] Load same player list, exclude scorer
  - [ ] Apply same smart sorting

- [ ] **Task 2: Implement Multi-Select UI** (AC: 3)
  - [ ] Checkbox next to each player name
  - [ ] Tap player item to toggle selection
  - [ ] Show checkmark when selected
  - [ ] Allow multiple selections

- [ ] **Task 3: Add Action Buttons** (AC: 4, 5)
  - [ ] "Skip" button: Save goal without assists, close modal
  - [ ] "Save" button: Save goal with selected assists, close modal
  - [ ] Both buttons trigger goal save logic

- [ ] **Task 4: Implement Auto-Save Timeout** (AC: 6)
  - [ ] Start 10-second timer on screen transition
  - [ ] Show countdown indicator (optional)
  - [ ] On timeout: Auto-save with no assists
  - [ ] Clear timeout on Skip or Save

- [ ] **Task 5: Save Assists to Database** (AC: 7)
  - [ ] For each selected player:
    - Generate UUID for goal_assist_id
    - Create goal_assist record: { id, goal_id, player_id, sync_state: 'pending' }
  - [ ] Batch insert to IndexedDB
  - [ ] Add to sync queue

- [ ] **Task 6: Add Long-Press Shortcut** (AC: 8)
  - [ ] Detect long-press on scorer (500ms)
  - [ ] On long-press: Skip assist screen, save goal immediately
  - [ ] Show tooltip: "Long-press to skip assists"

- [ ] **Task 7: Update Timeline Display** (AC: 9)
  - [ ] Load goal_assists for each goal
  - [ ] Display: "Goal: [Scorer] (Assists: [Name1], [Name2])"
  - [ ] Format: Comma-separated list

- [ ] **Task 8: Implement Atomic Sync** (AC: 10)
  - [ ] SyncService: Sync goal first, then assists
  - [ ] If goal sync fails, retry assists with goal
  - [ ] All-or-nothing: Goal + assists as single unit

- [ ] **Task 9: Write Tests** (AC: 11)
  - [ ] E2E test: Log goal with 2 assists
  - [ ] E2E test: Verify goal_assists records in DB
  - [ ] E2E test: Verify timeline display
  - [ ] E2E test: Long-press to skip assists

## Dev Notes

Component location: Update `/src/app/features/games/components/goal-log-modal/`

Assist tracking is optional to maintain fast workflow. Power users can use long-press for speed.

Auto-save timeout prevents workflow blocking during high-action game moments.

Multi-select pattern:
```typescript
selectedAssists = new Set<string>(); // Set of player IDs

toggleAssist(playerId: string) {
  if (this.selectedAssists.has(playerId)) {
    this.selectedAssists.delete(playerId);
  } else {
    this.selectedAssists.add(playerId);
  }
}
```

Long-press detection:
```typescript
private pressTimer: any;

onMouseDown(player: Player) {
  this.pressTimer = setTimeout(() => {
    this.saveGoalWithoutAssists();
  }, 500);
}

onMouseUp() {
  clearTimeout(this.pressTimer);
}
```

Atomic sync logic:
```typescript
async syncGoalWithAssists(goal: Goal, assists: GoalAssist[]) {
  const goalResult = await this.syncGoal(goal);
  if (goalResult.success) {
    await Promise.all(assists.map(a => this.syncAssist(a)));
  }
}
```

[Source: PRD Epic 5 Story 5.5, Architecture Section 7 Offline-First Architecture]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
