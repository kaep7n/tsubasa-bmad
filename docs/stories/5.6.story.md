# Story 5.6: Opponent Goal Tracking

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to track opponent goals with minimal effort,
**so that** the scoreboard reflects actual game state

## Acceptance Criteria
1. ✅ "Opponent Goal" button in goal logging modal
2. ✅ Single tap creates opponent_goal record
3. ✅ Record: Current minute, timestamp, sync_state='pending'
4. ✅ Updates scoreboard (opponent +1)
5. ✅ Shows toast "Opponent Goal - [Minute]'"
6. ✅ Opponent goals appear in timeline with distinct styling (red/amber)
7. ✅ Opponent score visible in live scoreboard header
8. ✅ No player selection required
9. ✅ Offline: opponent goal queued, visible immediately
10. ✅ Unit test: Verify opponent_goals sync logic
11. ✅ E2E test: Log opponent goal, verify scoreboard update

## Tasks / Subtasks

- [ ] **Task 1: Add Opponent Goal Button** (AC: 1)
  - [ ] Add button to goal logging modal (bottom)
  - [ ] Label: "Opponent Goal"
  - [ ] Style: warn color (red/amber)
  - [ ] Icon: opponent team icon

- [ ] **Task 2: Implement Opponent Goal Creation** (AC: 2, 3)
  - [ ] Click handler on button
  - [ ] Generate UUID for opponent_goal_id
  - [ ] Create opponent_goal record:
    - game_id
    - scored_at_minute = currentMinute()
    - scored_at_timestamp = new Date()
    - sync_state = 'pending'
  - [ ] Save to IndexedDB
  - [ ] Add to sync queue

- [ ] **Task 3: Update Scoreboard** (AC: 4, 7)
  - [ ] Increment opponent score signal
  - [ ] Ensure LiveScoreboardComponent displays opponent score
  - [ ] Both team and opponent scores visible

- [ ] **Task 4: Show Confirmation Toast** (AC: 5)
  - [ ] Toast: "Opponent Goal - [Minute]'"
  - [ ] Duration: 5 seconds
  - [ ] Include undo action

- [ ] **Task 5: Add to Timeline** (AC: 6)
  - [ ] GameTimelineComponent loads opponent_goals
  - [ ] Display: "[Minute]' - Opponent Goal"
  - [ ] Distinct styling: red/amber accent, different icon
  - [ ] Sort chronologically with team goals

- [ ] **Task 6: Offline Handling** (AC: 9)
  - [ ] Save to IndexedDB first
  - [ ] Queue for sync
  - [ ] Display immediately in timeline and scoreboard

- [ ] **Task 7: Write Tests** (AC: 10, 11)
  - [ ] Unit test: opponent_goal record creation
  - [ ] Unit test: Sync logic
  - [ ] E2E test: Log opponent goal
  - [ ] E2E test: Verify scoreboard increments
  - [ ] E2E test: Verify timeline display

## Dev Notes

Component location: Update `/src/app/features/games/components/goal-log-modal/`

Opponent goals are simplified (no player tracking) to maintain fast workflow during live game.

Future enhancement: Optional opponent player tracking can be added in post-MVP phase.

Opponent goal record:
```typescript
const opponentGoal: OpponentGoal = {
  id: crypto.randomUUID(),
  game_id: this.gameId,
  scored_at_minute: this.timerService.currentMinute(),
  scored_at_timestamp: new Date().toISOString(),
  sync_state: 'pending'
};
```

Timeline styling differentiation:
```css
.team-goal {
  border-left: 4px solid var(--color-success);
}
.opponent-goal {
  border-left: 4px solid var(--color-warn);
}
```

Modal flow:
1. User taps Log Goal FAB
2. Modal shows player list AND "Opponent Goal" button
3. Tap opponent goal → immediate save, no additional screens
4. Single tap = logged

[Source: PRD Epic 5 Story 5.6, Architecture Section 16 User Experience]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by QA Agent_

## QA Results
_To be populated by QA Agent_
