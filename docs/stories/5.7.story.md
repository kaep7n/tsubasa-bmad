# Story 5.7: Game Timeline & Event History

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to see a chronological list of all game events,
**so that** I can review what happened and verify accuracy

## Acceptance Criteria
1. ✅ `GameTimelineComponent` displays scrollable event list below scoreboard
2. ✅ Events displayed chronologically (most recent at top)
3. ✅ Event types: Goals, Opponent Goals, Half-time marker
4. ✅ Each event shows: minute, description, edit/delete icons
5. ✅ Visual styling: team goals (green), opponent goals (red), half-time (gray divider)
6. ✅ Tap event to expand details (scorer, assists, timestamp, notes)
7. ✅ Empty state: "No goals yet - tap the + button to start tracking"
8. ✅ Timeline updates reactively via Signals
9. ✅ Timeline persists scroll position during updates
10. ✅ Accessibility: semantic list markup, screen reader friendly

## Tasks / Subtasks

- [ ] **Task 1: Generate GameTimelineComponent** (AC: 1)
  - [ ] Run: `ng generate component features/games/components/game-timeline`
  - [ ] Position below LiveScoreboardComponent
  - [ ] Scrollable container

- [ ] **Task 2: Load Event Data** (AC: 2, 3)
  - [ ] Query goals from IndexedDB (game_id, ORDER BY scored_at_minute DESC)
  - [ ] Query opponent_goals from IndexedDB
  - [ ] Load goal_assists for each goal
  - [ ] Merge and sort chronologically
  - [ ] Add half-time marker at 45 minutes

- [ ] **Task 3: Build Event List Template** (AC: 4)
  - [ ] List item structure:
    - Left: Minute display ("[45]'")
    - Middle: Event description
    - Right: Edit/Delete icon buttons
  - [ ] Goals: "Goal by [Player Name]"
  - [ ] Goals with assists: "Goal by [Player] (Assists: [Name1], [Name2])"
  - [ ] Opponent goals: "Opponent Goal"
  - [ ] Half-time: Divider with "HALF TIME" text

- [ ] **Task 4: Apply Visual Styling** (AC: 5)
  - [ ] Team goals: Green left border accent
  - [ ] Opponent goals: Red/amber left border accent
  - [ ] Half-time: Gray horizontal divider
  - [ ] List item padding: 12px vertical, 16px horizontal

- [ ] **Task 5: Implement Event Expansion** (AC: 6)
  - [ ] Tap event to toggle expanded state
  - [ ] Expanded view shows:
    - Scorer (for goals)
    - Assists (if any)
    - Exact timestamp (HH:mm:ss)
    - Notes (if any)
  - [ ] Smooth collapse/expand animation

- [ ] **Task 6: Add Empty State** (AC: 7)
  - [ ] Show when events array is empty
  - [ ] Message: "No goals yet - tap the + button to start tracking"
  - [ ] Icon: Soccer ball illustration

- [ ] **Task 7: Implement Reactive Updates** (AC: 8)
  - [ ] Use Signal for events list
  - [ ] Subscribe to goals service changes
  - [ ] Update timeline reactively on new goal/edit/delete

- [ ] **Task 8: Persist Scroll Position** (AC: 9)
  - [ ] Save scroll position before update
  - [ ] Restore scroll position after update
  - [ ] Prevent jump-to-top on new event

- [ ] **Task 9: Add Accessibility** (AC: 10)
  - [ ] Semantic HTML: <ul>, <li>
  - [ ] ARIA labels for edit/delete buttons
  - [ ] Screen reader: Announce event type and details

- [ ] **Task 10: Write Tests**
  - [ ] Unit test: Event merging and sorting
  - [ ] Unit test: Expand/collapse state
  - [ ] E2E test: Log goal, verify appears in timeline
  - [ ] E2E test: Scroll position persists

## Dev Notes

Component location: `/src/app/features/games/components/game-timeline/`

Timeline is the primary review interface during and after live game tracking.

Event merging logic:
```typescript
const allEvents = [
  ...goals.map(g => ({ type: 'goal', ...g })),
  ...opponentGoals.map(og => ({ type: 'opponent_goal', ...og })),
  { type: 'half_time', scored_at_minute: 45 }
].sort((a, b) => b.scored_at_minute - a.scored_at_minute);
```

Scroll position persistence:
```typescript
@ViewChild('timelineContainer') container!: ElementRef;

updateEvents() {
  const scrollPos = this.container.nativeElement.scrollTop;
  this.events.set(newEvents);
  setTimeout(() => {
    this.container.nativeElement.scrollTop = scrollPos;
  });
}
```

Virtual scrolling consideration: If timeline exceeds 100 events, consider CDK Virtual Scroll for performance.

[Source: PRD Epic 5 Story 5.7, Architecture Section 16 User Experience]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
