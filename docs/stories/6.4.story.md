# Story 6.4: Post-Game Report Generation

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to generate a shareable report after each game,
**so that** I can send summaries to parents and league organizers

## Acceptance Criteria
1. ✅ "Generate Report" button on game detail screen (after game ends)
2. ✅ Report includes: header, goal timeline, player stats, attendance, notes
3. ✅ Report generated as HTML template with clean formatting
4. ✅ Export options: Copy to clipboard, Share (Web Share API), Download PDF, Print
5. ✅ Template styling: clean layout, team branding, mobile-friendly
6. ✅ Offline: report generated from IndexedDB
7. ✅ Preview before sharing: modal shows rendered report
8. ✅ E2E test: Generate report, verify sections, test copy to clipboard

## Tasks / Subtasks

- [ ] **Task 1: Add Generate Report Button** (AC: 1)
  - [ ] Game detail screen: Add button
  - [ ] Show only if game.status = 'completed'
  - [ ] Navigate to report generation

- [ ] **Task 2: Build Report Template** (AC: 2)
  - [ ] HTML template with sections:
    - Header: Team name, opponent, date, final score
    - Goal Timeline: Chronological list with scorers/assists
    - Player Stats: Goals and assists for this game
    - Attendance: List of players who attended
    - Notes: Editable text area for coach comments
  - [ ] Clean, professional styling

- [ ] **Task 3: Generate Report from Data** (AC: 3)
  - [ ] Load game, goals, goal_assists, game_attendance from IndexedDB
  - [ ] Populate template with data
  - [ ] Render as HTML string

- [ ] **Task 4: Implement Export Options** (AC: 4)
  - [ ] Copy to Clipboard: navigator.clipboard.writeText(html)
  - [ ] Share: navigator.share({ text, url }) if supported
  - [ ] Download PDF: Use jsPDF library to generate PDF
  - [ ] Print: window.print() with print CSS media query

- [ ] **Task 5: Apply Template Styling** (AC: 5)
  - [ ] Clean layout with margins, padding
  - [ ] Team logo placeholder (if uploaded)
  - [ ] Mobile-friendly: responsive design
  - [ ] Print-optimized: CSS @media print

- [ ] **Task 6: Offline Generation** (AC: 6)
  - [ ] All data from IndexedDB
  - [ ] No network requests
  - [ ] PDF generation client-side

- [ ] **Task 7: Add Preview Modal** (AC: 7)
  - [ ] Modal shows rendered report
  - [ ] Action buttons: Copy, Share, Download, Print, Close
  - [ ] Scrollable content

- [ ] **Task 8: Write Tests** (AC: 8)
  - [ ] E2E test: Generate report
  - [ ] E2E test: Verify all sections populated
  - [ ] E2E test: Copy to clipboard

## Dev Notes

Component location: `/src/app/features/games/components/game-report-modal/`

Template location: `/src/app/shared/templates/game-report.template.ts`

HTML template structure:
```html
<div class="game-report">
  <header>
    <h1>{{ teamName }} vs {{ opponent }}</h1>
    <p>{{ date }} | Final Score: {{ teamScore }} - {{ opponentScore }}</p>
  </header>
  <section class="goal-timeline">
    <h2>Goal Timeline</h2>
    <ul>
      <li *ngFor="let goal of goals">
        {{ goal.minute }}' - Goal by {{ goal.scorer }} (Assists: {{ goal.assists }})
      </li>
    </ul>
  </section>
  <section class="player-stats">
    <h2>Player Statistics</h2>
    <table>...</table>
  </section>
  <section class="attendance">
    <h2>Attendance</h2>
    <ul><li *ngFor="let player of attendees">{{ player.name }}</li></ul>
  </section>
  <section class="notes">
    <h2>Coach Notes</h2>
    <p>{{ notes }}</p>
  </section>
</div>
```

PDF generation:
```typescript
import jsPDF from 'jspdf';

generatePDF() {
  const doc = new jsPDF();
  const html = this.reportElement.nativeElement.innerHTML;
  doc.html(html, {
    callback: (pdf) => {
      pdf.save(`game-report-${this.gameId}.pdf`);
    }
  });
}
```

Copy to clipboard:
```typescript
async copyToClipboard() {
  const html = this.reportElement.nativeElement.innerHTML;
  await navigator.clipboard.writeText(html);
  this.snackBar.open('Report copied to clipboard', 'OK', { duration: 3000 });
}
```

[Source: PRD Epic 6 Story 6.4, Architecture Section 16 User Experience]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
