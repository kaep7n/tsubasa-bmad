# Story 6.6: Season Summary Report

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to generate an end-of-season summary report,
**so that** I can celebrate achievements with players and parents

## Acceptance Criteria
1. ✅ "Season Summary" option in Statistics menu
2. ✅ Report includes: season overview, team achievements, individual awards, player profiles
3. ✅ Coach can add custom comments per player (saved in database)
4. ✅ Export options: PDF, Print, Share (Web Share API)
5. ✅ Template styling: professional, celebratory, team branding
6. ✅ Generated entirely offline from IndexedDB
7. ✅ Preview modal before export
8. ✅ E2E test: Generate summary for 10-game season, verify awards

## Tasks / Subtasks

- [ ] **Task 1: Add Season Summary Menu Option** (AC: 1)
  - [ ] Statistics menu: "Season Summary" link
  - [ ] Navigate to `/statistics/season-summary`

- [ ] **Task 2: Build Report Sections** (AC: 2)
  - [ ] Section 1: Season Overview
    - Date range, games played, W-D-L record
  - [ ] Section 2: Team Achievements
    - Total goals scored
    - Best win (largest margin)
    - Longest winning streak
    - Cleansheet count (0 goals conceded)
  - [ ] Section 3: Individual Awards
    - Golden Boot (top scorer)
    - Playmaker Award (top assists)
    - Perfect Attendance (100% attendance)
    - Most Improved (largest goals/game increase)
  - [ ] Section 4: Player Profiles
    - Photo, name, stats, coach comment

- [ ] **Task 3: Implement Custom Comments** (AC: 3)
  - [ ] Add field: player_season_comments table
    - player_id, season_id, comment, created_at
  - [ ] Editable text area in player profile section
  - [ ] Save to Supabase and IndexedDB

- [ ] **Task 4: Implement Export Options** (AC: 4)
  - [ ] PDF: Multi-page document with jsPDF
  - [ ] Print: window.print() with page breaks
  - [ ] Share: Web Share API

- [ ] **Task 5: Apply Template Styling** (AC: 5)
  - [ ] Professional layout with typography
  - [ ] Celebratory colors and graphics
  - [ ] Team logo and branding
  - [ ] Photo placeholders if no photos

- [ ] **Task 6: Offline Generation** (AC: 6)
  - [ ] Load all data from IndexedDB
  - [ ] Calculate awards client-side
  - [ ] No network requests

- [ ] **Task 7: Add Preview Modal** (AC: 7)
  - [ ] Modal shows full report
  - [ ] Scrollable content
  - [ ] Action buttons: Export PDF, Print, Share, Close

- [ ] **Task 8: Write Tests** (AC: 8)
  - [ ] E2E test: Generate for 10-game season
  - [ ] E2E test: Verify Golden Boot calculated correctly
  - [ ] E2E test: Verify Perfect Attendance awarded
  - [ ] E2E test: Add coach comment, verify saved

## Dev Notes

Component location: `/src/app/features/statistics/pages/season-summary/`

Template location: `/src/app/shared/templates/season-summary.template.ts`

Award calculations:
```typescript
// Golden Boot
const topScorer = players.reduce((max, p) =>
  p.goalsScored > max.goalsScored ? p : max
);

// Playmaker Award
const topAssister = players.reduce((max, p) =>
  p.assists > max.assists ? p : max
);

// Perfect Attendance
const perfectAttendance = players.filter(p =>
  p.attendanceRate === 100
);

// Most Improved
const mostImproved = players.reduce((max, p) => {
  const improvement = p.goalsPerGameIncrease;
  return improvement > max.goalsPerGameIncrease ? p : max
});
```

Team achievements:
```typescript
// Best win
const bestWin = games
  .filter(g => g.result === 'win')
  .reduce((max, g) => {
    const margin = g.final_score_team - g.final_score_opponent;
    return margin > max.margin ? { game: g, margin } : max;
  }, { margin: 0 });

// Longest winning streak
let streak = 0, maxStreak = 0;
games.forEach(g => {
  if (g.result === 'win') {
    streak++;
    maxStreak = Math.max(maxStreak, streak);
  } else {
    streak = 0;
  }
});

// Cleansheet count
const cleansheets = games.filter(g =>
  g.final_score_opponent === 0
).length;
```

Player profile section includes photo, stats, and editable comment field for coach to add personalized feedback.

[Source: PRD Epic 6 Story 6.6, Architecture Section 16 User Experience]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
