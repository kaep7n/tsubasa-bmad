# Story 6.7: Statistics Privacy & Sharing Controls

## Status
Ready

## Assigned To
James (Dev Agent)

## Story
**As a** coach,
**I want** to control what statistics are visible and shareable,
**so that** I respect player privacy and parental preferences

## Acceptance Criteria
1. âœ… Team Settings page: "Statistics & Privacy" section with 3 toggles
2. âœ… Toggle: "Show comparative stats" (rankings/badges)
3. âœ… Toggle: "Allow CSV export"
4. âœ… Toggle: "Include photos in reports"
5. âœ… When "Show comparative stats" disabled: No rankings/badges, no individual awards
6. âœ… When "Allow CSV export" disabled: Export button hidden
7. âœ… When "Include photos in reports" disabled: Use initials avatars
8. âœ… Settings saved to team profile in Supabase
9. âœ… Settings synced offline to IndexedDB
10. âœ… Default settings: All toggles enabled
11. âœ… Unit test: Verify privacy settings respected
12. âœ… E2E test: Disable comparative stats, verify badges hidden

## Tasks / Subtasks

- [ ] **Task 1: Add Privacy Section to Settings** (AC: 1)
  - [ ] Team Settings page: Add "Statistics & Privacy" section
  - [ ] Three toggle switches with labels and descriptions

- [ ] **Task 2: Implement Show Comparative Stats Toggle** (AC: 2, 5)
  - [ ] Toggle: "Show comparative stats"
  - [ ] Description: "Display player rankings and top performer badges"
  - [ ] When disabled:
    - Hide top 3 badges in Player Stats table
    - Hide individual awards in Season Summary
    - Show team totals only

- [ ] **Task 3: Implement Allow CSV Export Toggle** (AC: 3, 6)
  - [ ] Toggle: "Allow CSV export"
  - [ ] Description: "Enable CSV export of player statistics"
  - [ ] When disabled:
    - Hide "Export to CSV" button in Player Stats
    - Prevent CSV generation via API

- [ ] **Task 4: Implement Include Photos Toggle** (AC: 4, 7)
  - [ ] Toggle: "Include photos in reports"
  - [ ] Description: "Show player photos in shared reports"
  - [ ] When disabled:
    - Use initials avatars instead of photos
    - Exclude photos from PDF exports

- [ ] **Task 5: Save Settings to Database** (AC: 8)
  - [ ] Add fields to teams table:
    - show_comparative_stats (boolean, default: true)
    - allow_csv_export (boolean, default: true)
    - include_photos_in_reports (boolean, default: true)
  - [ ] Update on toggle change
  - [ ] Save to Supabase

- [ ] **Task 6: Sync Settings Offline** (AC: 9)
  - [ ] Cache settings in IndexedDB
  - [ ] Load on app init
  - [ ] Respect settings in offline mode

- [ ] **Task 7: Set Default Values** (AC: 10)
  - [ ] All toggles default: enabled
  - [ ] Opt-out privacy model for MVP

- [ ] **Task 8: Write Tests** (AC: 11, 12)
  - [ ] Unit test: Privacy settings applied to report generation
  - [ ] Unit test: CSV export blocked when disabled
  - [ ] E2E test: Disable comparative stats, verify badges hidden
  - [ ] E2E test: Disable photos, verify avatars used

## Dev Notes

Settings location: `/src/app/features/settings/pages/team-settings/`

Database schema addition:
```sql
ALTER TABLE teams ADD COLUMN show_comparative_stats BOOLEAN DEFAULT true;
ALTER TABLE teams ADD COLUMN allow_csv_export BOOLEAN DEFAULT true;
ALTER TABLE teams ADD COLUMN include_photos_in_reports BOOLEAN DEFAULT true;
```

Privacy settings interface:
```typescript
interface TeamPrivacySettings {
  show_comparative_stats: boolean;
  allow_csv_export: boolean;
  include_photos_in_reports: boolean;
}
```

Conditional rendering example:
```html
<button *ngIf="privacySettings.allow_csv_export" (click)="exportCSV()">
  Export to CSV
</button>

<div *ngIf="privacySettings.show_comparative_stats" class="top-scorer-badge">
  ðŸ¥‡
</div>

<img *ngIf="privacySettings.include_photos_in_reports; else initialsAvatar"
     [src]="player.photo_url" />
<ng-template #initialsAvatar>
  <div class="avatar">{{ player.initials }}</div>
</ng-template>
```

Privacy settings are team-level, not player-level, for MVP simplicity. Future enhancement: per-player privacy preferences.

[Source: PRD Epic 6 Story 6.7, Architecture Section 5 Security]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-24 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_
